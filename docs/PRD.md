# Video Companion 产品需求文档 (PRD)

> **版本**: 1.1.0
> **最后更新**: 2026-01-14
> **状态**: 开发中

---

## 1. 产品概述

### 1.1 产品简介

**Video Companion** 是一款 Chrome 浏览器扩展，旨在为用户提供统一、便捷的网页视频控制体验。无论用户访问哪个视频网站，都能享受到一致的画中画、全屏、倍速控制等增强功能。

### 1.2 产品愿景

打造一款轻量级、高兼容性的视频增强工具，让用户摆脱不同视频平台的功能限制，获得自由、高效的视频观看体验。

### 1.3 核心价值

| 价值主张 | 描述 |
|---------|------|
| **统一体验** | 在任意网站使用相同的视频控制界面 |
| **功能增强** | 提供原生播放器不具备的高级功能 |
| **效率提升** | 通过快捷键实现快速操作 |
| **无侵入性** | 不修改网页原有内容，不影响正常浏览 |

---

## 2. 目标用户

### 2.1 用户画像

| 用户类型 | 特征描述 | 核心需求 |
|---------|---------|---------|
| **学习型用户** | 经常观看在线课程、教程视频 | 倍速播放、画中画多任务 |
| **娱乐型用户** | 频繁访问各类视频网站 | 全屏体验、便捷控制 |
| **效率型用户** | 需要边看视频边工作 | 画中画、快捷键操作 |
| **内容创作者** | 需要分析、截取视频内容 | 截图、精确控制 |

### 2.2 使用场景

1. **多任务场景**: 用户在工作时希望画中画观看视频
2. **学习场景**: 用户需要 2 倍速快速过完教程内容
3. **对比场景**: 用户需要截取视频画面进行记录
4. **沉浸场景**: 用户希望全屏观看但网站不提供全屏功能

---

## 3. 功能需求

### 3.1 功能清单

| ID | 功能名称 | 优先级 | 状态 | 描述 |
|----|---------|-------|------|------|
| F001 | 画中画模式 | P0 | ✅ 已实现 | 将视频悬浮在所有窗口之上 |
| F002 | 原生全屏 | P0 | ✅ 已实现 | 调用浏览器原生全屏 API |
| F003 | 网页全屏 | P0 | ✅ 已实现 | 视频充满网页可视区域 |
| F004 | 倍速控制 | P0 | ✅ 已实现 | 支持 0.5x - 3x 共 9 档 |
| F005 | 视频下载 | P1 | ✅ 已实现 | 下载可直接访问的视频源 |
| F006 | 视频截图 | P1 | ✅ 已实现 | 捕获当前帧并保存为图片 |
| F007 | 循环播放 | P2 | ✅ 已实现 | 视频结束后自动重播 |
| F008 | 静音控制 | P2 | ✅ 已实现 | 快速静音/取消静音 |
| F009 | 控制面板拖拽 | P1 | ✅ 已实现 | 面板可自由移动位置 |
| F010 | 快捷键支持 | P0 | ✅ 已实现 | 键盘快捷操作 |
| F011 | 隐藏原生控制器 | P2 | ✅ 已实现 | 隐藏/显示视频自身的控制条 |

### 3.2 功能详细说明

#### F001 画中画模式

**功能描述**: 将视频以悬浮窗口形式显示在所有应用程序之上

**触发方式**:
- 点击控制面板「画中画」按钮
- 快捷键: `Alt + P`

**预期行为**:
1. 点击后视频进入画中画模式
2. 再次点击或关闭悬浮窗退出画中画
3. 显示 Toast 提示当前状态

**技术依赖**: Picture-in-Picture API

**兼容性**: Chrome 70+, Edge 79+, Firefox 不支持

---

#### F002 原生全屏

**功能描述**: 调用浏览器 Fullscreen API 实现全屏播放

**触发方式**:
- 点击控制面板「全屏」按钮
- 快捷键: `Alt + F`

**预期行为**:
1. 视频进入浏览器原生全屏模式
2. 按 ESC 或再次点击退出
3. 显示 Toast 提示

**技术依赖**: Fullscreen API

---

#### F003 网页全屏

**功能描述**: 视频充满浏览器可视区域，但不进入系统全屏

**触发方式**:
- 点击控制面板「网页全屏」按钮

**预期行为**:
1. 视频元素扩展至 100vw × 100vh
2. 固定定位，z-index 置顶
3. 再次点击恢复原状

---

#### F004 倍速控制

**功能描述**: 调整视频播放速度

**触发方式**:
- 点击控制面板「倍速」按钮展开菜单
- 快捷键: `[` 减速, `]` 加速

**速度档位**:
```
0.5x → 0.75x → 1x → 1.25x → 1.5x → 1.75x → 2x → 2.5x → 3x
```

**预期行为**:
1. 选择速度后立即生效
2. 按钮显示当前速度值
3. 显示 Toast 提示当前速度

---

#### F005 视频下载

**功能描述**: 下载当前视频文件

**触发方式**:
- 点击控制面板「下载」按钮

**预期行为**:
1. 尝试获取视频 src 属性
2. 创建下载链接并触发下载
3. Blob URL / Data URL 提示不支持

**限制**:
- 仅支持直接可访问的视频源
- 不支持 HLS/DASH 流媒体
- 不支持有 DRM 保护的视频

---

#### F006 视频截图

**功能描述**: 捕获视频当前帧并保存为 PNG 图片

**触发方式**:
- 点击控制面板「截图」按钮

**预期行为**:
1. 使用 Canvas 绘制当前视频帧
2. 转换为 PNG 格式
3. 自动下载，文件名含时间戳

**限制**:
- 跨域视频可能因 CORS 策略失败

---

#### F007 循环播放

**功能描述**: 视频结束后自动从头播放

**触发方式**:
- 点击控制面板「循环」按钮

**预期行为**:
1. 开启/关闭视频 loop 属性
2. 按钮高亮显示当前状态
3. 显示 Toast 提示

---

#### F008 静音控制

**功能描述**: 快速切换视频静音状态

**触发方式**:
- 点击控制面板「静音」按钮

**预期行为**:
1. 切换视频 muted 属性
2. 按钮图标切换（🔊 / 🔇）
3. 显示 Toast 提示

---

#### F011 隐藏原生控制器

**功能描述**: 隐藏或显示视频元素自身的控制条

**触发方式**:
- 点击控制面板「隐藏控制器」按钮

**预期行为**:
1. 切换视频 controls 属性
2. 按钮图标切换（👁️ / 👁️‍🗨️）
3. 显示 Toast 提示当前状态

**技术依赖**: video.controls 属性

**使用场景**:
- 用户希望获得更简洁的视频界面
- 避免原生控制条与扩展控制面板重叠
- 配合网页全屏使用获得更沉浸的体验

---

### 3.3 快捷键列表

| 快捷键 | 功能 | 作用范围 |
|-------|------|---------|
| `Alt + P` | 切换画中画 | 当前焦点视频 |
| `Alt + F` | 切换全屏 | 当前焦点视频 |
| `[` | 降低播放速度 | 当前焦点视频 |
| `]` | 提高播放速度 | 当前焦点视频 |

---

## 4. 非功能需求

### 4.1 性能需求

| 指标 | 要求 |
|-----|------|
| 初始化时间 | < 100ms |
| 内存占用 | < 10MB |
| CPU 影响 | 空闲时 < 1% |
| 视频扫描频率 | 每 2 秒一次 |

### 4.2 兼容性需求

| 维度 | 要求 |
|-----|------|
| Chrome 版本 | 88+ (Manifest V3) |
| Edge 版本 | 88+ |
| 视频格式 | HTML5 `<video>` 标签 |
| 网站兼容 | 所有包含视频的网站 |

### 4.3 安全需求

| 要求 | 说明 |
|-----|------|
| 最小权限原则 | 仅申请必要的 activeTab、scripting 权限 |
| 无数据收集 | 不收集任何用户数据 |
| 本地运行 | 所有功能在本地执行 |

### 4.4 可用性需求

| 要求 | 说明 |
|-----|------|
| 即装即用 | 无需配置即可使用 |
| 视觉反馈 | 所有操作有 Toast 提示 |
| 非侵入性 | 不干扰网页原有功能 |
| 响应式设计 | 适配不同尺寸视频 |

---

## 5. 技术架构

### 5.1 架构概览

```
┌─────────────────────────────────────────────────────┐
│                    Chrome Browser                    │
├─────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  Web Page   │  │  Web Page   │  │  Web Page   │ │
│  │  ┌───────┐  │  │  ┌───────┐  │  │             │ │
│  │  │ Video │  │  │  │ Video │  │  │  No Video   │ │
│  │  └───┬───┘  │  │  └───┬───┘  │  │             │ │
│  │      │      │  │      │      │  │             │ │
│  │  ┌───▼───┐  │  │  ┌───▼───┐  │  │             │ │
│  │  │Control│  │  │  │Control│  │  │             │ │
│  │  │ Panel │  │  │  │ Panel │  │  │             │ │
│  │  └───────┘  │  │  └───────┘  │  │             │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
├─────────────────────────────────────────────────────┤
│                   Content Script                     │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐      │
│  │   Video    │ │    UI      │ │  Keyboard  │      │
│  │  Scanner   │ │  Manager   │ │  Handler   │      │
│  └────────────┘ └────────────┘ └────────────┘      │
└─────────────────────────────────────────────────────┘
```

### 5.2 核心模块

| 模块 | 职责 |
|-----|------|
| **Video Scanner** | 扫描页面视频，监听 DOM 变化 |
| **UI Manager** | 创建和管理控制面板 |
| **Keyboard Handler** | 处理快捷键事件 |
| **Feature Modules** | 各功能的具体实现 |

### 5.3 文件结构

```
video-companion-extension/
├── manifest.json        # 扩展配置
├── content.js           # 内容脚本（核心逻辑）
├── styles.css           # 控制面板样式
├── icons/               # 扩展图标
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── docs/                # 文档
    └── PRD.md
```

### 5.4 API 依赖

| API | 用途 | 兼容性 |
|-----|------|-------|
| Picture-in-Picture API | 画中画功能 | Chrome 70+ |
| Fullscreen API | 全屏功能 | 广泛支持 |
| Canvas API | 截图功能 | 广泛支持 |
| MutationObserver | DOM 监听 | 广泛支持 |

---

## 6. 用户界面设计

### 6.1 控制面板

**位置**: 视频左上角，距边缘 10px

**尺寸**: 自适应内容

**外观**:
- 背景: 半透明黑色 (rgba(0, 0, 0, 0.7))
- 圆角: 8px
- 阴影: 轻微投影

**行为**:
- 默认: 3 秒无操作后隐藏
- 鼠标悬停视频时显示
- 可拖拽移动位置

### 6.2 按钮设计

| 属性 | 规格 |
|-----|------|
| 尺寸 | 32px × 32px |
| 图标 | Emoji 图标 |
| 间距 | 4px |
| 悬停效果 | 背景变亮 |

### 6.3 按钮图标

| 功能 | 图标 | 激活态 |
|-----|------|-------|
| 画中画 | 📺 | - |
| 全屏 | ⛶ | - |
| 网页全屏 | 🖥️ | - |
| 倍速 | ⚡ | 显示当前速度 |
| 下载 | ⬇️ | - |
| 截图 | 📷 | - |
| 循环 | 🔁 | 高亮 |
| 静音 | 🔊 | 🔇 |
| 隐藏控制器 | 👁️ | 👁️‍🗨️ |

### 6.4 Toast 提示

**位置**: 视频中央

**样式**:
- 背景: 黑色半透明
- 文字: 白色
- 动画: 淡入淡出
- 时长: 2 秒

---

## 7. 版本规划

### v1.0.0 (当前版本)

**目标**: 完成核心功能，可正常使用

- [x] 画中画模式
- [x] 全屏 / 网页全屏
- [x] 倍速控制
- [x] 视频下载
- [x] 视频截图
- [x] 循环播放
- [x] 静音控制
- [x] 快捷键支持
- [ ] 完善样式文件
- [ ] 添加扩展图标

### v1.1.0 (规划中)

**目标**: 增强用户体验

- [ ] 记忆上次播放速度
- [ ] 自定义快捷键
- [ ] 音量滑块控制
- [ ] 进度条预览
- [ ] 亮度/对比度调节

### v1.2.0 (规划中)

**目标**: 扩展功能

- [ ] Popup 设置页面
- [ ] 网站黑名单
- [ ] 统计观看时间
- [ ] 多语言支持

### v2.0.0 (远期规划)

**目标**: 高级功能

- [ ] 视频画质选择
- [ ] 字幕加载
- [ ] 视频滤镜
- [ ] 同步播放（多设备）

---

## 8. 风险与限制

### 8.1 已知限制

| 限制 | 描述 | 影响范围 |
|-----|------|---------|
| 跨域截图 | CORS 策略限制跨域视频截图 | 部分网站 |
| 流媒体下载 | 不支持 HLS/DASH 格式 | 大多数视频网站 |
| DRM 保护 | 无法操作受保护内容 | Netflix 等平台 |
| Firefox 不支持 | 画中画 API 兼容性 | Firefox 用户 |
| Shadow DOM | 可能无法检测到视频 | 部分框架网站 |

### 8.2 风险评估

| 风险 | 可能性 | 影响 | 缓解措施 |
|-----|-------|------|---------|
| 网站更新导致失效 | 中 | 低 | 使用标准 API |
| 与其他扩展冲突 | 低 | 中 | 命名空间隔离 |
| 浏览器 API 变更 | 低 | 高 | 关注 Chrome 更新 |

---

## 9. 测试要点

### 9.1 功能测试

| 测试项 | 测试步骤 | 预期结果 |
|-------|---------|---------|
| 视频检测 | 打开包含视频的页面 | 控制面板自动出现 |
| 画中画 | 点击按钮或按 Alt+P | 视频进入画中画 |
| 全屏 | 点击按钮或按 Alt+F | 视频全屏显示 |
| 倍速调节 | 选择 2x 速度 | 视频以 2 倍速播放 |
| 截图 | 点击截图按钮 | 下载当前帧图片 |

### 9.2 兼容性测试

| 网站 | 测试视频类型 | 预期兼容性 |
|-----|-------------|-----------|
| YouTube | HTML5 Video | ✅ 完全兼容 |
| Bilibili | HTML5 Video | ✅ 完全兼容 |
| Netflix | DRM Protected | ⚠️ 部分功能 |
| 本地视频 | File Protocol | ✅ 完全兼容 |

---

## 10. 附录

### 10.1 术语表

| 术语 | 定义 |
|-----|------|
| PiP | Picture-in-Picture，画中画模式 |
| Content Script | 注入到网页中运行的扩展脚本 |
| Manifest V3 | Chrome 扩展最新配置规范 |
| Toast | 短暂显示的提示消息 |

### 10.2 参考链接

- [Chrome Extensions Documentation](https://developer.chrome.com/docs/extensions/)
- [Picture-in-Picture API](https://developer.mozilla.org/en-US/docs/Web/API/Picture-in-Picture_API)
- [Fullscreen API](https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API)

### 10.3 相关文档

- [商业化规划](./COMMERCIAL.md) - 产品商业化策略、定价与推广

---

*文档结束*
